"undefined"!=typeof module&&module.exports&&(this.later=require("later")),schedule=function(p){"use strict";var m={version:"0.6.3"};if(p)return Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(null==this)throw new TypeError;var r=Object(this),n=r.length>>>0;if(0==n)return-1;var t=0;if(1<arguments.length&&((t=Number(arguments[1]))!=t?t=0:0!=t&&t!=1/0&&t!=-1/0&&(t=(0<t||-1)*Math.floor(Math.abs(t)))),n<=t)return-1;for(var a=0<=t?t:Math.max(n-Math.abs(t),0);a<n;a++)if(a in r&&r[a]===e)return a;return-1}),m.date={},m.date.UTC=function(){p.date.UTC()},m.date.localTime=function(){p.date.localTime()},m.functor=function(e){return"function"==typeof e?e:function(){return e}},m.memoizedRangeFn=function(n){var t={};return function(e){var r;return t[e]||(r=n(1,e),t[e]=[r[0]?r[0].getTime():41024448e5,r[1]?r[1].getTime():41024448e5]),t[e]}},m.sort={},m.sort.tasks=function(a,e){e.sort(function(e,r){var n=a.tasks[e],t=a.tasks[r];return t.priority&&(!n.priority||t.priority>n.priority)?-1:n.priority&&(!t.priority||n.priority>t.priority)?1:a.tasks[r].floatAmt>a.tasks[e].floatAmt})},m.resources=function(){var d=e,c=n,f=t;function r(e){for(var r=[],n=m.functor(d),t=m.functor(c),a=m.functor(f),i=0,s=e.length;i<s;i++){var u=e[i],o=n.call(this,u,i),l=t.call(this,u,i),u=a.call(this,u,i);r.push({id:o,available:l,isNotReservable:u})}return r}return r.id=function(e){return arguments.length?(d=e,r):d},r.available=function(e){return arguments.length?(c=e,r):c},r.isNotReservable=function(e){return arguments.length?(f=e,r):f},r},m.tasks=function(){var f=a,h=i,v=s,p=u,g=o,y=l,b=d;function r(e){for(var r=[],n=m.functor(f),t=m.functor(h),a=m.functor(v),i=m.functor(p),s=m.functor(g),u=m.functor(y),o=m.functor(b),l=0,d=e.length;l<d;l++){var c=e[l],c={id:n.call(this,c,l),duration:t.call(this,c,l),available:a.call(this,c,l),resources:i.call(this,c,l),dependsOn:s.call(this,c,l),minSchedule:u.call(this,c,l),priority:o.call(this,c,l)};r.push(c)}return r}return r.id=function(e){return arguments.length?(f=e,r):f},r.duration=function(e){return arguments.length?(h=e,r):h},r.available=function(e){return arguments.length?(v=e,r):v},r.resources=function(e){return arguments.length?(p=e,r):p},r.dependsOn=function(e){return arguments.length?(g=e,r):g},r.minSchedule=function(e){return arguments.length?(y=e,r):y},r.priority=function(e){return arguments.length?(b=e,r):b},r},m.dependencyGraph=function(e){function d(e,r,n,t){for(var a=t?function(e,r){return e<r}:function(e,r){return r<e},i=0,s=r.length;i<s;i++){var u=r[i];e[u]?(e[u][0]=e[u][0]+1,e[u][1]=a(n,e[u][1])?n:e[u][1]):e[u]=[1,n]}}function c(e){return!e||0===e.length}for(var r=e,n={tasks:{},roots:[],leaves:[],resources:[],depth:0,end:0},t=0,a=r.length;t<a;t++){var i=r[t];n.tasks[i.id]={id:i.id,duration:i.duration,priority:i.priority,schedule:i.schedule,minSchedule:i.minSchedule,dependsOn:i.dependsOn,resources:i.resources}}var s,u=n;for(s in u.tasks){var o=u.tasks[s];if(!c(o.resources))for(var l=0,f=o.resources.length;l<f;l++){var h=o.resources[l];-1===u.resources.indexOf(h)&&u.resources.push(h)}}var v,p=n.tasks;for(v in p){var g=p[v],y=g.dependsOn;if(!c(y))for(var b=0,m=y.length;b<m;b++){var x=p[y[b]];(x.requiredBy||(x.requiredBy=[])).push(g.id)}}var k,R=n;for(k in R.tasks){k=R.tasks[k];c(k.dependsOn)&&R.roots.push(k.id),c(k.requiredBy)&&R.leaves.push(k.id)}!function e(r,n,t){for(var a=0,i=n.length;a<i;a++){var s=r.tasks[n[a]],u=s.dependsOn;s.depth=!s.depth||t>s.depth?t:s.depth,r.depth=t>r.depth?t:r.depth,c(u)||e(r,u,s.depth+1)}}(n,n.leaves,0),n.depth+=1,function e(r,n,t,a){d(n,t,a);for(var i=0,s=t.length;i<s;i++){var u=t[i],o=r.tasks[u],l=o.dependsOn,u=n[u];!o.earlyFinish&&(c(l)||u&&u[0]===l.length)&&(o.earlyStart=u[1],o.earlyFinish=u[1]+o.duration,c(o.requiredBy)||e(r,n,o.requiredBy,o.earlyFinish))}}(n,{},n.roots,0);for(var A=n,O=n.leaves,S=0,F=O.length;S<F;S++){var w=A.tasks[O[S]].earlyFinish;A.end=w>A.end?w:A.end}return function e(r,n,t,a){d(n,t,a,!0);for(var i=0,s=t.length;i<s;i++){var u=t[i],o=r.tasks[u],l=o.requiredBy,u=n[u];(c(l)||u&&u[0]===l.length)&&(o.lateStart=u[1]-o.duration,o.lateFinish=u[1],o.floatAmt=o.lateFinish-o.earlyFinish,c(o.dependsOn)||e(r,n,o.dependsOn,o.lateStart))}}(n,{},n.leaves,n.end),n},m.resourceManager=function(e,r){var i={schedules:[{fd_a:[r.getTime()]}]},f=function(e,r){var n={};if(e)for(var t=0,a=e.length;t<a;t++)s(n,e[t],r);return n}(e,r);function s(e,r,n){var t=JSON.parse(JSON.stringify(r.available||i)),a=m.memoizedRangeFn(p.schedule(t).nextRange);e[r.id]={schedule:t,next:a,nextAvail:a(n)}}function a(e,r,n,t){var a,i=[],s={},u=50;for(!function e(r,n,t,a){for(var i=0,s=r.length;i<s;i++){var u,o,l,d=r[i];Array.isArray(d)?(e(d,n,l=[],u={}),(o=h(u))&&(a[o]=u[o]),c(u={subRanges:l}),t.push(u)):(o=f[d],(l=o.nextAvail[0]>=n?o.nextAvail:o.next(n))[0]>n&&"_proj"!==d&&(a[d]={needed:n,available:l[0]}),t.push({id:d,range:l}))}}(e,r,i,s);!(a=function(e,r,n){for(var t,a,i={success:!1},s=[],u=0,o=e.length;u<o;u++){var l=e[u],d=l.range;"_"!==l.id[0]&&s.push(l.id),t=!t||d[0]>t?d[0]:t,a=!a||d[1]<a?d[1]:a}var c=(a-t)/p.MIN;(r<=c||n<=c)&&(i=function(e,r,n){var t=r+n*p.MIN,n={resources:e,start:r,end:t,duration:n,success:!0};return function(e,r,n){for(var t=0,a=e.length;t<a;t++){var i=f[e[t]];i.isNotReservable||(r!==i.nextAvail[0]&&(i.schedule.exceptions||(i.schedule.exceptions=[]),i.schedule.exceptions.push({fd_a:[r],fd_b:[n]}),i.next=m.memoizedRangeFn(p.schedule(i.schedule).nextRange),n=i.nextAvail[0]),i.nextAvail=i.next(n))}}(e,r,t),n}(s,t,c=n&&n<c?n:c));return i}(i,n,t)).success&&--u;)!function e(r,n,t){for(var a=0,i=r.length;a<i;a++){var s=r[a];s.range[1]>n||(s.subRanges?(e(s.subRanges,n,{}),c(s)):(s.range=f[s.id].next(n),"_proj"===s.id||t[s.id]||(t[s.id]={needed:n,available:s.range[0]})))}}(i,function(e){for(var r,n=0,t=e.length;n<t;n++){var a=e[n].range[1];r=!r||a<r?a:r}return r}(i),s);return a.delays=s,a}function c(e){for(var r,n,t=0,a=e.subRanges.length;t<a;t++){var i=e.subRanges[t];(!r||i.range[0]<n[0])&&(r=i.id,n=i.range)}e.id=r,e.range=n}function h(e){var r,n,t;for(t in e){var a=e[t].available;(!r||a<r)&&(r=a,n=t)}return n}return{getResource:function(e){return f[e]},addResource:function(e,r,n){for(var t=0,a=e.length;t<a;t++){var i="object"!=typeof e[t]?{id:r+e[t]}:{id:r+e[t].id,available:e[t].available,isNotReservable:e[t].isNotReservable};f[i.id]||s(f,i,n)}},makeReservation:function(e,r,n,t){return a(e,(r=r?new Date(r):new Date).getTime(),n||1,t)},optimize:function(e){for(var r in f){var n=f[r];if(n.schedule.exceptions){var t=n.schedule.exceptions;n.schedule.exceptions=[];for(var a=0,i=t.length;a<i;a++)(!t[a].fd_b||t[a].fd_b>e)&&n.schedule.exceptions.push(t[a]);n.next=m.memoizedRangeFn(p.schedule(n.schedule).nextRange)}n.nextAvail[0]<e&&(n.nextAvail=n.next(e))}}}},m.create=function(e,r,n,t){if(!Array.isArray(e))throw new Error("Tasks are required and must be passed in as an array.");if(r&&!Array.isArray(r))throw new Error("Resources must be passed in as an array.");var a=t?new Date(t):new Date;if(!a||!a.getTime())throw new Error("Invalid start date specified.");var l=m.dependencyGraph(e),o=m.resourceManager(r,a),d={};for(var t=[],i=(o.addResource(l.resources,"",a),o.addResource([{id:"_proj",available:n}],"",a),o.addResource(e,"_task",a),l.roots),s=i.slice(0),u={},c=0,f=i.length;c<f;c++)u[i[c]]=[0,a.getTime()];for(;s.length;){m.sort.tasks(l,s);var h=l.tasks[s.pop()],v=u[h.id][1],v=function(e,r){var n=["_proj","_task"+e.id],t=e.resources?n.concat(e.resources):n,a=e.duration,i=r,s={schedule:[],duration:e.duration};for(;a;){var u=o.makeReservation(t,i,e.minSchedule||1,a);if(!u.success)return;s.earlyStart=s.earlyStart||u.start,s.schedule.push(u),a-=u.duration,i=u.end}return s.earlyFinish=i,d[e.id]=s,i}(h,v);v&&h.requiredBy&&(!function(e,r,n,t){for(var a=0,i=n.length;a<i;a++){var s=n[a],u=l.tasks[s].dependsOn,o=r[s]||(r[s]=[0,0]);o[0]+=1,o[1]=t>o[1]?t:o[1],(!u||o[0]>=u.length)&&e.push(s)}}(s,u,h.requiredBy,v),o.optimize(function(e){var r,n;for(n in e)(!r||r>e[n][1])&&(r=e[n][1]);return r}(u)))}return r=function(e,r){for(var n,t,a=0,i=e.length;a<i;a++){var s=d[e[a].id];s?(n=!n||s.earlyStart<n?s.earlyStart:n,t=!t||s.earlyFinish>t?s.earlyFinish:t):r.push(e[a].id)}return[n,t]}(e,t),function e(r,n){for(var t=0,a=r.length;t<a;t++){var i=d[r[t]],s=l.tasks[r[t]].dependsOn;i&&(i.lateFinish=n,i.floatAmt=(i.lateFinish-i.earlyFinish)/p.MIN,s&&e(s,i.earlyStart))}}(l.leaves,r[1]),{scheduledTasks:d,failedTasks:t.length?t:null,success:0===t.length,start:r[0],end:r[1]}},m;function e(e){return e.id}function n(e){return e.available}function t(e){return e.isNotReservable||!1}function a(e){return e.id}function i(e){return e.duration}function s(e){return e.available}function u(e){return e.resources}function o(e){return e.dependsOn}function l(e){return e.minSchedule}function d(e){return e.priority}throw new Error("Laterjs must be included before Schedulejs.")}(this.later);